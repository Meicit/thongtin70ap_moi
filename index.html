<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ThÃ´ng tin áº¤p</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4 space-y-6">

    <!-- Chá»n áº¤p -->
    <section class="bg-white shadow rounded-2xl p-6">
      <h2 class="text-xl font-semibold mb-4">ğŸ˜ï¸ Chá»n áº¤p</h2>
      <select id="apSelect" class="p-2 border rounded"></select>
    </section>

    <!-- ThÃ´ng tin áº¤p -->
    <section id="info" class="bg-white shadow rounded-2xl p-6">
      <h2 class="text-xl font-semibold mb-4">â„¹ï¸ ThÃ´ng tin áº¤p</h2>
      <div id="apInfo"></div>
    </section>

    <!-- Báº£n Ä‘á»“ PDF -->
    <section id="map" class="bg-white shadow rounded-2xl p-6">
      <h2 class="text-xl font-semibold mb-4">ğŸ“ Báº£n Ä‘á»“ áº¤p</h2>
      <div class="w-full h-[500px]">
        <iframe id="apMap"
          class="w-full h-full rounded-xl border"
          title="Báº£n Ä‘á»“ áº¤p"></iframe>
      </div>
    </section>

    <!-- NhÃ¢n sá»± tá»« Excel -->
    <section id="people" class="bg-white shadow rounded-2xl p-6">
      <h2 class="text-xl font-semibold mb-4">ğŸ‘¥ NhÃ¢n sá»± áº¤p</h2>
      <ul id="apPeople" class="space-y-2"></ul>
    </section>
  </div>

  <script>
  let apData = {}; // lÆ°u dá»¯ liá»‡u tá»« Excel

  // HÃ m Ä‘á»c file Excel tá»•ng há»£p thÃ´ng tin áº¤p
  async function loadThongTinAp() {
    const response = await fetch("data/thongtin_ap.xlsx");
    const arrayBuffer = await response.arrayBuffer();
    const data = new Uint8Array(arrayBuffer);
    const workbook = XLSX.read(data, { type: "array" });
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    const json = XLSX.utils.sheet_to_json(sheet);

    // LÆ°u dá»¯ liá»‡u theo key
    json.forEach(row => {
      apData[row.ApKey] = row;
    });

    // Táº¡o danh sÃ¡ch chá»n áº¤p
    const apSelect = document.getElementById("apSelect");
    apSelect.innerHTML = Object.values(apData)
      .map(ap => `<option value="${ap.ApKey}">${ap.TenAp}</option>`)
      .join("");

    // Load máº·c Ä‘á»‹nh áº¤p Ä‘áº§u tiÃªn
    loadAp(Object.keys(apData)[0]);
  }

  // HÃ m Ä‘á»c file Excel nhÃ¢n sá»± cho tá»«ng áº¤p
  async function loadExcelNhanSu(filePath) {
    try {
      const response = await fetch(filePath);
      const arrayBuffer = await response.arrayBuffer();
      const data = new Uint8Array(arrayBuffer);
      const workbook = XLSX.read(data, { type: "array" });
      const sheetName = workbook.SheetNames[0];
      const sheet = workbook.Sheets[sheetName];
      const json = XLSX.utils.sheet_to_json(sheet);

      const apPeople = document.getElementById("apPeople");
      apPeople.innerHTML = json
        .map(row => `<li>ğŸ‘¤ <strong>${row.Há»TÃªn}</strong> â€“ ${row.Chá»©cDanh} â€“ ğŸ“± ${row.SÄT}</li>`)
        .join("");
    } catch (error) {
      console.error("Lá»—i khi táº£i Excel nhÃ¢n sá»±:", error);
    }
  }

  // HÃ m load dá»¯ liá»‡u áº¤p theo key
  function loadAp(apKey) {
    const ap = apData[apKey];
    if (!ap) return;

    // cáº­p nháº­t thÃ´ng tin áº¤p
    document.getElementById("apInfo").innerHTML = `
      <p><strong>TÃªn áº¤p:</strong> ${ap.TenAp}</p>
      <p><strong>Diá»‡n tÃ­ch:</strong> ${ap.DienTich}</p>
      <p><strong>DÃ¢n sá»‘:</strong> ${ap.DanSo}</p>
      <p><strong>Äá»‹a chá»‰:</strong> ${ap.DiaChi}</p>
    `;

    // cáº­p nháº­t báº£n Ä‘á»“ PDF
    document.getElementById("apMap").src = `${ap.MapFile}#toolbar=0&navpanes=0&scrollbar=0`;

    // cáº­p nháº­t nhÃ¢n sá»±
    loadExcelNhanSu(ap.ExcelNhanSu);
  }

  // Sá»± kiá»‡n chá»n áº¤p
  document.getElementById("apSelect").addEventListener("change", (e) => {
    loadAp(e.target.value);
  });

  // Khá»Ÿi Ä‘á»™ng
  document.addEventListener("DOMContentLoaded", loadThongTinAp);
  </script>
</body>
</html>
